<div class="mapeo-cajas" [class.overlay-open]="activeModal() === 'caja'">
  <!-- MAPA (100%) con botones/hints dentro para respetar márgenes -->
  <section class="map-area">
    <app-mapa-cajas-view
      [iconSizeMap]="iconSizeMap"
      [picking]="picking()"
      [selectedCoords]="pickedCoords()"
      [instantCajas]="cajas"
      (mapClick)="onMapClick($event)"
    ></app-mapa-cajas-view>

    <!-- SIEMPRE visible; el overlay lo cubrirá cuando esté abierto -->
    <div class="fab-toolbar">
      <button class="btn-red" type="button" (click)="openCrearCaja()">
        Crear caja
      </button>
    </div>

    @if (picking()) {
    <div class="pick-hint">Haz clic en el mapa para elegir la ubicación…</div>
    }
  </section>

  <!-- OVERLAY de formulario (ancho completo, sobrepuesto) -->
  <section class="overlay" [class.open]="activeModal() === 'caja'">
    <div class="overlay-card full">
      <app-mapa-cajas-controls
        [coords]="pickedCoords()"
        (requestPick)="startPickingFromMap()"
        (created)="onCajaCreated($event)"
        (close)="closeModal()"
      ></app-mapa-cajas-controls>
    </div>
  </section>
</div>
