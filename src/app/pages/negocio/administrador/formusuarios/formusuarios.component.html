<!-- Overlay local del componente -->
@if (!isReady) {
<div class="skeleton-title"></div>
<div class="skeleton-block"></div>
} @else {
<div class="fade-in">
  <main>
    <section class="container mt-3">
      <div class="shadow p-5">
        <h2>{{ tipo }} Usuario</h2>

        <form [formGroup]="usuarioForm" (ngSubmit)="getDataForm()">
          <!-- NOMBRES -->
          <div class="my-3">
            <label class="form-label" for="nombre">Nombres</label>
            <input
              class="form-control"
              type="text"
              id="nombre"
              formControlName="nombre"
              placeholder="INGRESE LOS NOMBRES"
              style="text-transform: uppercase"
              (input)="convertToUppercase('nombre')"
            />
            @if (checkControl('nombre','required')) {
            <p class="error">El campo es requerido</p>
            } @if (checkControl('nombre','minlength')) {
            <p class="error">Mínimo 3 caracteres requeridos</p>
            }
          </div>

          <!-- APELLIDOS -->
          <div class="my-3">
            <label class="form-label" for="apellido">Apellidos</label>
            <input
              class="form-control"
              type="text"
              id="apellido"
              formControlName="apellido"
              placeholder="INGRESE LOS APELLIDOS"
              style="text-transform: uppercase"
              (input)="convertToUppercase('apellido')"
            />
            @if (checkControl('apellido','required')) {
            <p class="error">El campo es requerido</p>
            } @if (checkControl('apellido','minlength')) {
            <p class="error">Mínimo 3 caracteres requeridos</p>
            }
          </div>

          <!-- CÉDULA -->
          <div class="my-3">
            <label class="form-label" for="ci">Ci</label>
            <input
              class="form-control"
              type="text"
              id="ci"
              formControlName="ci"
              placeholder="INGRESE LA CÉDULA"
            />
            @if (checkControl('ci','required')) {
            <p class="error">El campo es requerido</p>
            } @if (checkControl('ci','civalidator')) {
            <p class="error">
              {{ usuarioForm.get('ci')?.errors?.['civalidator'] }}
            </p>
            }
          </div>

          <!-- USUARIO -->
          <div class="my-3">
            <label class="form-label" for="usuario">Usuario</label>
            <input
              class="form-control"
              type="text"
              id="usuario"
              formControlName="usuario"
              placeholder="INGRESE EL USUARIO"
            />
            @if (checkControl('usuario','required')) {
            <p class="error">El campo es requerido</p>
            } @if (checkControl('usuario','minlength')) {
            <p class="error">Mínimo 3 caracteres requeridos</p>
            }
          </div>

          <!-- PASSWORD -->
          <div class="my-3">
            <label class="form-label" for="password">Password</label>
            <input
              class="form-control"
              type="password"
              id="password"
              formControlName="password"
              placeholder="INGRESE EL PASSWORD"
            />
            @if (checkControl('password','required')) {
            <p class="error">El campo es requerido</p>
            } @if (checkControl('password','minlength')) {
            <p class="error">Mínimo 6 caracteres requeridos</p>
            }
          </div>

          <!-- FECHA NACIMIENTO -->
          <div class="my-3">
            <label class="form-label" for="fecha_nac">
              Fecha de nacimiento
            </label>
            <input
              class="form-control"
              type="date"
              id="fecha_nac"
              formControlName="fecha_nac"
              placeholder="Ingrese fecha de nacimiento"
            />
            @if (checkControl('fecha_nac','required')) {
            <p class="error">El campo es requerido</p>
            }
          </div>

          <!-- FECHA CONTRATACIÓN -->
          <div class="my-3">
            <label class="form-label" for="fecha_cont">
              Fecha de contratación
            </label>
            <input
              class="form-control"
              type="date"
              id="fecha_cont"
              formControlName="fecha_cont"
              placeholder="Ingrese fecha de contratación"
            />
            @if (checkControl('fecha_cont','required')) {
            <p class="error">El campo es requerido</p>
            }
          </div>

          <!-- GÉNERO -->
          <div class="my-3">
            <label class="form-label">Género</label>
            <div class="d-flex justify-content-around">
              <label>
                <input
                  type="radio"
                  id="generoM"
                  formControlName="genero"
                  value="M"
                  name="genero"
                />
                Masculino
              </label>
              <label class="ms-3">
                <input
                  type="radio"
                  id="generoF"
                  formControlName="genero"
                  value="F"
                  name="genero"
                />
                Femenino
              </label>
            </div>
          </div>

          <!-- SUCURSAL -->
          <div class="my-3">
            <label class="form-label" for="sucursal_id">Sucursal</label>
            <select
              class="form-select"
              id="sucursal_id"
              formControlName="sucursal_id"
            >
              <option [ngValue]="null" disabled>
                -- Seleccione sucursal --
              </option>
              @for (s of sucursales; track s.id) {
              <option [ngValue]="s.id">{{ s.nombre }} ({{ s.codigo }})</option>
              }
            </select>
            @if (checkControl('sucursal_id','required')) {
            <p class="error">La sucursal es requerida</p>
            }
          </div>

          <!-- DEPARTAMENTO -->
          <div class="my-3">
            <label class="form-label" for="departamento_id">Departamento</label>
            <select
              class="form-select"
              id="departamento_id"
              formControlName="departamento_id"
            >
              <option [ngValue]="null" disabled>
                -- Seleccione departamento --
              </option>
              @for (d of departamentos; track d.id) {
              <option [ngValue]="d.id">{{ d.nombre }} ({{ d.codigo }})</option>
              }
            </select>
            @if (checkControl('departamento_id','required')) {
            <p class="error">El departamento es requerido</p>
            }
          </div>

          <!-- TABLA FUNCIONES / ROLES -->
          <table class="table border border-1 mt-4">
            <thead>
              <tr>
                @for (rol of
                ['Administrador','Bodega','Noc','Clientes','Técnico','Recuperacion
                Cartera']; track $index) {
                <th>{{ rol }}</th>
                }
              </tr>
            </thead>
            <tbody>
              <tr>
                @for (rol of
                ['Administrador','Bodega','Noc','Clientes','Técnico','Recuperacion
                Cartera']; track $index) {
                <td>
                  @for (funcion of arrfunciones; track $index) { @if
                  (funcion.nombre.startsWith(rol[0])) {
                  <p>
                    {{ funcion.nombre.slice(1) }}
                    <input
                      type="checkbox"
                      [checked]="selectedIds.includes(funcion.id)"
                      (change)="onToggleRol(funcion.id, $event)"
                    />
                  </p>
                  } }
                </td>
                }
              </tr>
            </tbody>
          </table>

          <!-- BOTONES -->
          <div class="d-flex justify-content-around mt-4">
            <input
              type="submit"
              [value]="tipo"
              class="btn btn-danger"
              [disabled]="!usuarioForm.valid"
            />
            <input
              type="button"
              value="Cancelar"
              class="btn btn-secondary"
              [routerLink]="['/home', 'administrador', 'usuarios']"
            />
          </div>
        </form>
      </div>
    </section>
  </main>
</div>
}
